jobs:
- name: update-eirinifs
  plan:
  - get: eirinifs
  - get: launcher
    trigger: true
  - get: cflinuxfs2-image
    trigger: true
  - get: eirinifs-version
    params:
      bump: major
  - put: eirinifs-version
    params:
      file: eirinifs-version/version
  - task: build eirinifs
    privileged: true
    file: eirinifs/ci/build-eirinifs.yml
  - put: eirinifs-release
    params:
      name: eirinifs-version/version
      tag: eirinifs-version/version
      tag_prefix: v
      globs:
      - go/src/github.com/cloudfoundry-incubator/eirinifs/image/eirinifs.tar

resources:
- name: eirinifs
  type: git
  source:
    uri: https://github.com/cloudfoundry-incubator/eirinifs.git
    branch: master
- name: launcher
  type: git
  source:
    uri: https://github.com/cloudfoundry-incubator/eirinifs.git
    branch: master
    paths:
    - launchcmd/launch.go
    - launcher.go
- name: cflinuxfs2-image
  type: docker-image
  source:
    repository: cloudfoundry/cflinuxfs2
- name: eirinifs-release
  type: github-release
  source:
    owner: cloudfoundry-incubator
    repository: eirinifs
    access_token: ((github-access-token))
- name: eirinifs-version
  type: semver
  source:
    driver: git
    uri: git@github.com:cloudfoundry/eirini-private-config.git
    branch: eirinifs-release-version
    file: version
    private_key: ((github-private-key))

